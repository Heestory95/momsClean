<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mom.admin.mapper.home.HomeMapper">

	<sql id="total_list">
		<if test="searchType == null">
			and rnum between #{sizePerPage} *#{page}-9
			and
			#{sizePerPage} *#{page}
		</if>
	</sql>

	<select id="list" resultType="Home">
		<![CDATA[
		 WITH paginated_references AS (
		SELECT reference_no, user_no, reference_title ,reference_date , rownum as rnum
		FROM (
			SELECT reference_no, user_no, reference_title , reference_date 
			FROM reference 
			WHERE reference_no > 0 and TRUNC(reference_date) = TRUNC(sysdate)
            ORDER BY user_no ASC) paginated
           OFFSET #{sizePerPage} * (#{page} - 1) ROWS FETCH NEXT #{sizePerPage} ROWS ONLY
          ) 
          SELECT a.reference_no, a.user_no, a.reference_title, b.user_name, a.reference_date
          FROM paginated_references a inner join user_tbl b on a.user_no = b.user_no
          WHERE a.reference_no > 0 
          ]]>
	</select>
<<<<<<< HEAD

=======
	
>>>>>>> 6636ceacaa99a46f62bde318e02816faf2208ec1
	<select id="review" resultType="Home">
	 	<![CDATA[
	 	WITH paginated_reviews AS (
	 	select review_no, reserve_no, user_no, review_grade, review_content, review_date
		from (SELECT review_no, reserve_no, user_no, review_grade, review_content, review_date, rownum as rnum
		  FROM (select review_no, reserve_no, user_no, review_grade, review_content, review_date
		  		from review
		  		order by review_no desc)
<<<<<<< HEAD
		  	
		 where review_no > 0 and TRUNC(review_date) = TRUNC(sysdate)
		 order by review_no desc) paginated
=======
		 where review_no > 0 and TRUNC(review_date) = TRUNC(sysdate)
		order by review_no desc) paginated
>>>>>>> 6636ceacaa99a46f62bde318e02816faf2208ec1
		OFFSET #{sizePerPage} * (#{page} - 1) ROWS FETCH NEXT #{sizePerPage} ROWS ONLY
    		)
    	SELECT review_no, reserve_no, user_no, review_grade, review_content, review_date
    	FROM paginated_reviews
    	where review_no > 0
    	order by review_no desc
		]]>
	</select>

	<!-- 게시글 목록 전체 건수 조회 -->
	<select id="count" resultType="int">
		<![CDATA[
			SELECT count(reference_no)
			FROM reference
			WHERE reference_no > 0
		]]>
	</select>

	<select id="request" resultType="Home">

		<![CDATA[
			SELECT reserve_no, user_no, user_id, user_name, item_no, reserve_state, reserve_addr, reserve_item_price, reserve_option_price, reserve_date, clean_date, reserve_request, rownum as rnum
			FROM (
				SELECT reserve_no, user_no, user_id, user_name, item_no, reserve_state, reserve_addr, reserve_item_price, reserve_option_price, reserve_date, clean_date, reserve_request
				FROM reserve
				WHERE reserve_state = '예약대기' and TRUNC(reserve_date) = TRUNC(sysdate)
    		ORDER BY reserve_date ASC) 
		]]>
	</select>

	<!-- 예약취소율 통계용 쿼리 -->
	<select id="reserveCount" resultType="int">
		<![CDATA[
			SELECT count(reserve_no)
			FROM reserve
			WHERE reserve_state = '예약완료'
			AND clean_done = 'Y'
		]]>
	</select>

	<select id="cancelCount" resultType="int">
		<![CDATA[
			SELECT count(reserve_no)
			FROM reserve
			WHERE reserve_state = '취소완료'
			 AND clean_done = 'N'
		]]>
	</select>

	<!-- 상품판매율 통계용 쿼리 -->
	<select id="itemCount1" resultType="int">
		<![CDATA[
			SELECT count(reserve_no)
			FROM reserve
			WHERE reserve_state = '예약완료' AND clean_done = 'Y' AND reserve_no LIKE '18%'
		]]>
	</select>
	<select id="itemCount2" resultType="int">
		<![CDATA[
			SELECT count(reserve_no)
			FROM reserve
			WHERE reserve_state = '예약완료' AND clean_done = 'Y' AND reserve_no LIKE '25%'
		]]>
	</select>
	<select id="itemCount3" resultType="int">
		<![CDATA[
			SELECT count(reserve_no)
			FROM reserve
			WHERE reserve_state = '예약완료' AND clean_done = 'Y' AND reserve_no LIKE '30%'
		]]>
	</select>
	<select id="itemCount4" resultType="int">
		<![CDATA[
			SELECT count(reserve_no)
			FROM reserve
			WHERE reserve_state = '예약완료' AND clean_done = 'Y' AND reserve_no LIKE '35%'
		]]>
	</select>
	<select id="itemCount5" resultType="int">
		<![CDATA[
			SELECT count(reserve_no)
			FROM reserve
			WHERE reserve_state = '예약완료' AND clean_done = 'Y' AND reserve_no LIKE '40%'
		]]>
	</select>
	<select id="itemCount6" resultType="int">
		<![CDATA[
			SELECT count(reserve_no)
			FROM reserve
			WHERE reserve_state = '예약완료' AND clean_done = 'Y' AND reserve_no LIKE '50%'
		]]>
	</select>
	
	<select id="itemSales7" resultType="int">
		<![CDATA[
			SELECT sum(reserve_item_price)
			FROM reserve
			WHERE reserve_state = '예약완료' AND clean_done = 'Y' AND TO_CHAR(reserve_date, 'YYYYMM') = '202307'
		]]>
	</select>
	
	<select id="optionSales7" resultType="int">
		<![CDATA[
			SELECT sum(reserve_option_price)
			FROM reserve
			WHERE reserve_state = '예약완료' AND clean_done = 'Y' AND TO_CHAR(reserve_date, 'YYYYMM') = '202307'
		]]>
	</select>
	
	<select id="totalSales7" resultType="int">
		<![CDATA[
			SELECT sum(reserve_item_price + reserve_option_price)
			FROM reserve
			WHERE reserve_state = '예약완료' AND clean_done = 'Y' AND TO_CHAR(reserve_date, 'YYYYMM') = '202307'
		]]>
	</select>
	
	<select id="monthlyReserveCount7" resultType="int">
		<![CDATA[
			SELECT 
			count(TO_CHAR(reserve_date, 'YYYYMM'))
			FROM reserve
			WHERE reserve_state = '예약완료' AND clean_done = 'Y' AND TO_CHAR(reserve_date, 'YYYYMM') = '202307'
			GROUP BY TO_CHAR(reserve_date, 'YYYYMM')
		]]>
	</select>
	<!-- 신규 예약현황의 select문 where절에 들어갈 현재날짜와 예약날짜 비교 쿼리 -->
	<!-- TRUNC(reserve_date) = TRUNC(sysdate) -->
</mapper>